# LATTE++ compiler x64

⚠️ User discresion is advised ⚠️

# Prerequisites

gcc compiler (provided on students machine), that you can install with

# Build

```
make
```

After the build 'latc' binary will be created alongside and runtime.o object will appear in lib directory

# Clean

```
make clean
```

# Run

```
./latc <latte file>

Example
./latc example.lat
```

# External programs used

    - bnfc - used to generate abstract syntax tree

# Compiler Info

    - Compiler architecture: x86-64
    - Registers are allocated using greedy graph coloring, similiar to that used in V8 compiler
    - Implemented optimizations:
        - Abstract:
            - dead code removal based on conditional statements with known values and return statements
            - abstract tree based constant folding
        - Quadruples:
            - local copy propagation
            - dead code removal
            - LCSE
        - Asm:
            - constant propagation (implemented during register allocation due to how quadruples implemented by me work)
            - simple optimizations of reduntant instructions
    - Implemented extenstions:
        - arrays
        - structures
        - objects
        - virtual methods

# TODOs

    - current index/register quadruples make it hard to take full advantage of SSA during optimizations (global optimization not really viable) - use registers only

# Directory Structure

```
├── lib
|   └── runtime.c               # builtin functions definitions
├── src
|   ├── Abstract                # working with AST
|   |   ├── Optimizer           # constant folding and dead code deletion
|   |   |   ├── Optimizer.hs    # optimizer main logic
|   |   |   ├── Data.hs         # data structures and associated logic
|   |   |   └── Utils.hs        # general purpose logic
|   |   ├── Typechecker         # typechecker and return checker
|   |   |   ├── TypeChecker.hs  # optimizer main logic
|   |   |   ├── Data.hs         # data structures and associated logic
|   |   |   └── Utils.hs        # general purpose logic
|   |   └── Self.hs             # adding self. prefix to attribute usages inside methods
|   ├── Compiler
|   |   ├── Optimizer
|   |   |   └── Optimizer.hs    # redundant code optimizer
|   |   ├── Compiler.hs         # main compiler logic
|   |   └── Data.hs             # structures for code generation
|   ├── Quadruples              # generating SSA quadruples for compiler to work with
|   |   ├── Optimizer
|   |   |   ├── Lcse            # local common subexpresson optimizer
|   |   |   |   ├── Data.hs     # structures for lcse
|   |   |   |   └── Lcse.hs     # main lcse logic
|   |   |   ├── Data.hs         # structures for quad optimization
|   |   |   └── Optimizer.hs    # local copy propagation, dead code removal, using lcse optimizer
|   |   ├── Data.hs             # quadruples structures definitions
|   |   ├── Predata.hs          # structures for preprocessing (offsets)
|   |   ├── Preprocess.hs       # class structures preprocessing (offsets)
|   |   └── Quadruples.hs       # quadruples generator from AST
|   ├── Syntax                  # BNFC generated directory
|   |   └── ...                 # files generated by BNFC
|   ├── Main.hs                 # main runner file
|   ├── Utils.hs                # project general purpose functions
|   └── latc                    # script copied to root directory when 'make' command is used
├── Makefile                    # Main makefile
└── README.md                   # Me :skull:
```
